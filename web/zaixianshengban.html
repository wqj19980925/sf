<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title>在线申办</title>
		<link rel="stylesheet" href="./css/head.css">
		<link rel="stylesheet" href="./css/appointment.css">
		<script src="./js/shipei.js"></script>
		<link rel="stylesheet" href="./css/mobileSelect.css">

	</head>
	<style>
		.section {
			width: 22rem;
			overflow: hidden;
			margin: 1rem auto;
		}
		
		textarea {
			float: right;
			height: 6rem;
			width: 13rem;
		}
		
		.button {
			width: 100%;
			height: auto;
			display: inline-block;
			margin: 1.2rem auto;
			text-align: center;
		}
		
		.select {
			width: 22rem;
			margin: .5rem auto;
			height: 3rem;
		}
		
		.select select,
		.select input {
			width: 13rem;
			height: 1.8rem;
			font-size: .9rem;
			margin-top: .5rem;
			border: 1px solid #999;
		}
		
		.select p {
			text-align: right;
			width: 8rem;
			line-height: 3rem;
			font-size: .8rem
		}
		
		.region input {
			float: right;
		}
		
		.section_img {
			margin-left: 1rem;
			display: inline-block;
		}
		
		.section_img>form {
			margin-left: 0;
		}
		
		.ingg p {
			width: 18rem;
			margin: 0.5rem auto;
		}
		
		.img1,
		.img2 {
			margin-top: .5rem;
		}
		
		.myFiled2,
		.otherFiled2 {
			top: 15.7rem;
		}
		#yes,#no,.sure{
			width:1rem;
			height:1rem;
			vertical-align: middle;
			margin-right:.5rem;
		}
		.tishi{
	        position: fixed;
	        top: 50%;
	        left: 50%;
	        width: 6rem;
	        height: auto;
	        padding: .5rem;
	        display: none;
	        background: rgba(0,0,0,.5);
	        text-align: center;
	        color: #fff;
	        border-radius: .25rem;
	        margin-left: -3rem;
	        z-index: 999999;
	    }
	</style>

	<body>
		<header>
			<div class="header">
				<div class="head">
					<div class="img" onClick="history.go(-1)">
						<img src="./img/return_03.png" alt="">
					</div>
					<div class="title">
						<p>在线申办</p>
					</div>
				</div>
			</div>
		</header>
		<div class="section">
			<div class="iij">
				<div style="width: 100%;display: flex;font-size: .8rem">
					<p style="width: 8rem;text-align: right;margin-right: 1rem">双方是否同意调解</p>
					<div><img src="img/no.png" id="yes"><label>是</label>&nbsp;&nbsp;&nbsp;&nbsp;<img src="img/no.png" id="no"><label>否</label></div>
				</div>

			</div>
			<div class="sec2" style="display:none">
				<div class="region select">
					<p>选择调解类别</p>
					<input type="text" name="types" placeholder="请选择调解类别" readonly="readonly" onfocus='this.blur();' class="types">
				</div>
				<div class="region select">
					<p>所在区域</p>
					<input type="text" name="regions" placeholder="请选择所在区域" readonly="readonly" onfocus='this.blur();' class="regions">
				</div>
				<div class="region select">
					<p>选择调解机构</p>
					<input type="text" name="mechanism" placeholder="请选择所在调解机构" readonly="readonly" onfocus='this.blur();' class="mechanism">
				</div>
				<div class="xinjia" style="display:none">
					<div class="region select">
						<p>当事人姓名</p>
						<input type="text" name="uname" class="myName">
					</div>
					<div class="region select">
						<p>当事人身份证号</p>
						<input type="text" class="myNumber" id="myNumber" onblur="isCardNo($(this).val(),$(this).attr('id'))">
					</div>
					<div class="region select">
						<p>当事人手机号</p>
						<input type="text" class="myPhone" id="myPhone" onblur="checkMobile($(this).val(),$(this).attr('id'),$(this).attr('id'))">
					</div>
					<div class="region select">
						<p class="yanzhengma">验证码</p>
						<input style="width: 7.4rem;position:absolute;margin-left:.5rem;text-align: left;" type="text" class="gz_lianxi4"><input class="verify_f" style="width:5rem;background:#fff;outline:none;" type="button" value="发送验证码">
					</div>
                </div>
                <div class="old" style="display:none">
					<div class="region select">
						<p>当事人姓名</p>
						<span class="myName"></span>
					</div>
					<div class="region select">
						<p>当事人身份证号</p>
						<span class="myNumber"></span>
					</div>
					<div class="region select">
						<p>当事人手机号</p>
						<span class="myPhone"></span>
					</div>
				</div>
				<div class="region select">
					<p>对方当事人姓名</p>
					<input type="text" class="adverse_name">
				</div>

				<div class="region select">
					<p>对方当事人身份证号</p>
					<input type="text" onblur="isCardNo($(this).val(),$(this).attr('id'))" id="adverse_idnum" class="adverse_idnum">
				</div>

				<div class="region select">
					<p>对方当事人手机号</p>
					<input type="text" onblur="checkMobile($(this).val(),$(this).attr('id'))" id="adverse_tel" class="adverse_tel">
				</div>
				<div class="section_img" style="height: 32rem;">
					<form action="">
						<div class="img_left">
							<p style="width: auto;text-align: left;">
								当事人身份证正反面
							</p>
							<img class="img1 myImg1" src="./img/shangchuan.png" alt="">
							<input class="filed2 myFiled1" type="file">
							<img class="img1 myImg2" src="./img/shangchuan.png" alt="">
							<input class="filed2 myFiled2" type="file">
						</div>
					</form>
					<form action="">
						<div class="img_left">
							<p style="width: auto;text-align: left;">
								对方当事人身份证正反面
							</p>
							<img class="img2 otherImg1" src="./img/shangchuan.png" alt="">
							<input class="filed2 otherFiled1" type="file">
							<img class="img2 otherImg2" src="./img/shangchuan.png" alt="">
							<input class="filed2 otherFiled2" type="file">
						</div>
					</form>
				</div>
				<div class="ingg">
					<p>
						<img src="img/no.png" class="sure" />
						<a>
							我已阅读公示内容
						</a>
					</p>
				</div>
				<div class="button">
					<!--onclick="window.location.href= 'renmintiaojie.html';return false"-->
					<input type="submit" class="submit" >
				</div>
			</div>
		</div>
		<div class="Modal-frame">
			<p>投诉成功</p>
		</div>
		<div class="footer"></div>
		<!-- <p class="tishi" style="display: none;">未填写完整</p> -->
	</body>
</html>
<script src="./js/jquery-3.3.1.min.js"></script>
<script src="./js/mobileSelect.js"></script>
<!--<script src="js/jquery-1.11.3.min.js"></script>-->
<script>
	function showTips(text){
		$('body').append('<p class="tishi" style="display: none;">'+ text +'</p>');
		if($('.tishi').css('display')=='none'){
			$('.tishi').stop(true).fadeIn();
			setTimeout(function(){
				$('.tishi').stop(true).fadeOut();
				$('.tishi').remove();
			},3000);
		}
	};
	function isCardNo(card,id) { 
// 身份证号码为15位或者18位，15位时全为数字，18位前17位为数字，最后一位是校验位，可能为数字或字符X 
   if(card.length!=0){
     var reg = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/; 
    if(reg.test(card) === false) { 
        showTips("身份证号格式不正确");
        // $(".tishi").fadeIn().delay(500).fadeOut();
        $("#"+id).val("")
        return false; 
    } 
   }
}

//发送验证码
$(".verify_f").click(function(){
    clearInterval(timer)
    var mobile=$(".myPhone").val();
    $.ajax({
        type:'post',
        url:'http://sf.wokerr.com/index.php/home/Login/yzm',
        data:{
            mobile:mobile
        },
        dataType:'json', 
        async: true,   //同步异步
        success:function(data){
            console.log(data);
            if(data.state==1){
                yzm=data.data.yzm;
                timer=setInterval(function(){
                    tim--;
                    $(".verify_f").val(tim+"s");
                    if(tim<=0){
                        tim=60;
                        $(".verify_f").val("重新发送");
                        clearInterval(timer)
                    }
                },1000)
            }else{
                $(".verify_f").val("发送失败");
            }
            
        }
    })
})
	function checkMobile(val,id){ 
 // var sMobile = document.mobileform.mobile.value 
 if(!(/^1[3|4|5|8][0-9]\d{4,8}$/.test(val))){ 
  showTips("请填写正确的手机号"); 
  $("#"+id).val("");
  // document.mobileform.mobile.focus(); 
  return false; 
 } 
} 
	$(".footer").load("footer2.html");
	var access_token = localStorage.getItem('access_token');
	
	var proposerfront_img,proposercontrary_img,adversefront_img,adversecontrary_img,id_consent;
		$("#no").attr("src","img/yes.png")
		$("#yes").click(function() {
			$("#yes").attr('src','img/yes.png');
			$("#no").attr('src','img/no.png');
			$(".sec2").show();
			$(".iij").hide();
			id_consent=1;
		})
		$("#no").click(function() {
			$("#no").attr('src','img/yes.png');
			$("#yes").attr('src','img/no.png');
			$(".tishi").text("请同意调解")
			$('.tishi').stop(true).fadeIn();
			setTimeout(function(){
				$('.tishi').stop(true).fadeOut();
				$('.tishi').remove();
			},3000);
			id_consent=2;
		})
		$('.sure').click(function(){
			if($(this).attr('src')=='img/no.png'){
				$(this).attr('src','img/yes.png');
			}else{
				$(this).attr('src','img/no.png');
			}
		})
		$('.myFiled1').change(function() {
			var file = this.files[0];
			if(window.FileReader) {
				var reader = new FileReader();
				reader.readAsDataURL(file);
				//监听文件读取结束后事件    
				reader.onloadend = function(e) {
					// 图片base64
					proposerfront_img = e.target.result.split(",")[1];
					$(".myImg1").attr("src", e.target.result)
				};
			}
		});
		$('.myFiled2').change(function() {
			var file = this.files[0];
			if(window.FileReader) {
				var reader = new FileReader();
				reader.readAsDataURL(file);
				//监听文件读取结束后事件    
				reader.onloadend = function(e) {
					// 图片base64
					proposercontrary_img = e.target.result.split(",")[1];
					$(".myImg2").attr("src", e.target.result)
				};
			}
		});
		$('.otherFiled1').change(function() {
			var file = this.files[0];
			if(window.FileReader) {
				var reader = new FileReader();
				reader.readAsDataURL(file);
				//监听文件读取结束后事件    
				reader.onloadend = function(e) {
					// 图片base64
					adversefront_img = e.target.result.split(",")[1];
					$(".otherImg1").attr("src", e.target.result)
				};
			}
		});
		$('.otherFiled2').change(function() {
			var file = this.files[0];
			if(window.FileReader) {
				var reader = new FileReader();
				reader.readAsDataURL(file);
				//监听文件读取结束后事件    
				reader.onloadend = function(e) {
					// 图片base64
					adversecontrary_img = e.target.result.split(",")[1];
					$(".otherImg2").attr("src", e.target.result)
				};
			}
		});
	//用户信息
	var tokenState;
	$.ajax({
		type: "post",
		url: "http://sf.wokerr.com/index.php/home/Personal/mine",
		async: true,
		data: {
			access_token: access_token
		},
		dataType: 'json',
		success: function(data) {
			console.log(data);
			tokenState=data.state;
			if(data.state!='-2'){
				$('.myName').html(data.data.xm);
				$('.myNumber').html(data.data.zjh);
				$('.myPhone').html(data.data.lxdh);
				$('.old').css('display','block');
			}else{
				$('.xinjia').css('display','block');
			}
		}
	});
	//	调解类别
	$.ajax({
		type: "POST",
		url: "http://sf.wokerr.com/index.php/home/Data/tj_type",
		data: {},
		dataType: 'json',
		success: function(data) {
			//              console.log(data);
			var typeHTML = [];
			var index = data.data;
			for(var i = 0; i < data.data.length; i++) {
				typeHTML.push(data.data[i].title);
			}
			console.log(typeHTML)
			var mobileSelect1 = new MobileSelect({
				trigger: '.types',
				title: '请选择调解类别',
				wheels: [{
					data: typeHTML
				}],
				position: [0], //初始化定位 打开时默认选中的哪个 如果不填默认为0
				transitionEnd: function(indexArr, data) {
					//console.log(data);
				},
				callback: function(indexArr, data) {
					//                        console.log(data);
					$(".types").attr("value", data)
					for(i = 0; i < index.length; i++) {
						if(data == index[i].title) {
							$(".types").attr('id', index[i].id);
						}
					};
				}
			});
		}
	})
	//	所在区域
	$.ajax({
		type: "POST",
		url: "http://sf.wokerr.com/index.php/home/Data/area",
		data: {},
		dataType: 'json',
		success: function(data) {
			console.log(data);
			var typeHTML = [];
			var index = data.data;
			for(var i = 0; i < data.data.length; i++) {
				typeHTML.push(data.data[i].name);
			}
			//             console.log(typeHTML)
			var mobileSelect1 = new MobileSelect({
				trigger: '.regions',
				title: '请选择区域',
				wheels: [{
					data: typeHTML
				}],
				position: [0], //初始化定位 打开时默认选中的哪个 如果不填默认为0
				transitionEnd: function(indexArr, data) {
					//console.log(data);
				},
				callback: function(indexArr, data) {
					//                        console.log(data);
					$(".regions").attr("value", data)
					for(i = 0; i < index.length; i++) {
						if(data == index[i].name) {
							$(".regions").attr('id', index[i].id);
						}
					};
				}
			});
		}
	})
	//	调解机构
	$.ajax({
		type: "POST",
		url: "http://sf.wokerr.com/index.php/home/Data/twh",
		data: {},
		dataType: 'json',
		success: function(data) {
			console.log(data);
			var typeHTML = [];
			var index = data.data;
			for(var i = 0; i < data.data.length; i++) {
				typeHTML.push(data.data[i].jgmc);
			}
			//             console.log(typeHTML)
			var mobileSelect1 = new MobileSelect({
				trigger: '.mechanism',
				title: '请选择调解机构',
				wheels: [{
					data: typeHTML
				}],
				position: [0], //初始化定位 打开时默认选中的哪个 如果不填默认为0
				transitionEnd: function(indexArr, data) {
					//console.log(data);
				},
				callback: function(indexArr, data) {
					//                        console.log(data);
					$(".mechanism").attr("value", data)
					for(i = 0; i < index.length; i++) {
						if(data == index[i].jgmc) {
							$(".mechanism").attr('id', index[i].id);
						}
					};
				}
			});
		}
	})
	function showImg(img){
		img=img.substr(img.indexOf(','));
		img=img.substr(1);
		return img;
	}
	//提交
	$('.submit').click(function() {
		if(tokenState=='-2'){
			var name=$(".myName").val();
		    var id_card=$(".myNumber").val();
		    var verify_code=$(".gz_lianxi4").val();
		    var mobile=$(".myPhone").val();
		    
		}
		var jg_id=$('.mechanism').attr('id');
		var jg_name=$('.mechanism').val();
		var tj_type=$('.types').attr('id');
		var area_id=$('.regions').attr('id');
		var adverse_name=$('.adverse_name').val();
		var adverse_idnum=$('.adverse_idnum').val();
		var adverse_tel=$('.adverse_tel').val();
		if(!tj_type){
			showTips('请选择调解类别');
		}else if(!area_id){
			showTips('请选择所在区域');
		}else if(!jg_id || !jg_name){
			showTips('请选择所在调解机构');
		}else if(!adverse_name){
			showTips('请填写对方当事人姓名');
		}else if(!adverse_idnum){
			showTips('请填写对方当事人身份证号');
		}else if(!adverse_tel){
			showTips('请填写对方当事人手机号');
		}else if(!proposerfront_img){
			showTips('请选择当事人身份证正面');
		}else if(!proposercontrary_img){
			showTips('请选择当事人身份证反面');
		}else if(!adversefront_img){
			showTips('请选择对方当事人身份证正面');
		}else if(!adversecontrary_img){
			showTips('请选择对方当事人身份证正面');
		}else if($('.sure').attr('src')=='img/no.png'){
			showTips('请勾选公示内容');
		}else{
			if(tokenState=='-2'){
				if(!name){
			    	showTips('请填写当事人姓名');
			    	return false;
			    }else if(!id_card){
			    	showTips('请填写当事人身份证号');
			    	return false;
			    }else if(!mobile){
			    	showTips('请填写当事人手机号');
			    	return false;
			    }else if(!verify_code){
			    	showTips('请填写验证码');
			    	return false;
			    }
			}
			$.ajax({
				type: "POST",
				url: "http://sf.wokerr.com/index.php/home/Handle/tj_bid",
				async:false,
				data: {
					access_token:access_token,
					proposerfront_img:proposerfront_img,
					proposercontrary_img:proposercontrary_img,
					adversefront_img:adversefront_img,
					adversecontrary_img:adversecontrary_img,
					jg_id:jg_id,
					jg_name:jg_name,
					tj_type:tj_type,
					area_id:area_id,
					adverse_name:adverse_name,
					adverse_idnum:adverse_idnum,
					adverse_tel:adverse_tel,
					id_consent:id_consent,
					name:name,
		            id_card:id_card,
		            verify_code:verify_code,
		            mobile:mobile
				},
				dataType: 'json',
				success: function(data) {
					console.log(data);

					if(data.state==1){
						showTips(data.msg);
						setTimeout(function(){
						   javascript:history.go(-1);
						},1000)
					}else{
						showTips(data.msg);
					}
				}
			})
		}
	})
</script>